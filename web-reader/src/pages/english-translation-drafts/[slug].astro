---
import type { GetStaticPaths } from 'astro';
import { getCollection, type CollectionEntry, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export const prerender = true;

interface Props {
  entry: CollectionEntry<'english-translation-drafts'>;  nextPage: { slug: string; title: string } | null;
  prevPage: { slug: string; title: string } | null;
}

export const getStaticPaths: GetStaticPaths = async () => {
  const entries = await getCollection('english-translation-drafts');
  const sortedEntries = entries
    .sort((a, b) => a.data.date.localeCompare(b.data.date));

  return sortedEntries.map((entry, index) => {
    const nextPage = index < sortedEntries.length - 1
      ? { slug: sortedEntries[index + 1].id, title: sortedEntries[index + 1].id }
      : null;
    const prevPage = index > 0
      ? { slug: sortedEntries[index - 1].id, title: sortedEntries[index - 1].id }
      : null;

    return {
      params: { slug: entry.id, id: entry.id },
      props: { 
        entry,
        nextPage,
        prevPage
      },
    };
  });
};

const { entry, nextPage, prevPage } = Astro.props;
const { Content } = await render(entry);
---

<Layout title={`${entry.data.title} - The Archeometer`}>
  <div class="relative">
    {/* YouTube Section */}
    {entry.data.youtubeEmbedLink && (
      <div class="bg-white dark:bg-gray-800 shadow sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:p-6">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">{entry.data.youtubeEmbedTitle}</h2>
          <div class="aspect-video w-full">
            <iframe
            class="w-full h-full rounded-lg"
            src={entry.data.youtubeEmbedLink}
            title={entry.data.youtubeEmbedTitle}
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
            ></iframe>
          </div>
          <p class="mt-4 text-gray-600 dark:text-gray-300">
            Join me on this series where we read along and I comment on books. The book we're reading now is "The Archeometer - KEY TO ALL RELIGIONS AND ALL SCIENCES OF ANTIQUITY", an english translation of L'Archéomètre - Clef de toutes les religions et de toutes by Saint-Yves D'Alveydre.
          </p>
          <a 
            href="https://www.youtube.com/playlist?list=PLBqcbZfBWZxLGGxRYfYEZQDPwGJpDPXS4" 
            target="_blank" 
            rel="noopener noreferrer"
            class="flex mt-4 bg-indigo-600 hover:bg-indigo-800 w-full text-white font-bold py-2 px-4 rounded"
          >
            View on YouTube
          </a>
        </div>
      </div>
    )}

    {/* Fixed Navigation */}
    <div class="fixed bottom-0 left-0 right-0 z-10 block navigation-buttons">
      <div class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
          {prevPage && (
            <a
              href={`/english-translation-drafts/${prevPage.slug}`}
              class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shrink-0"
            >
              ← Previous
            </a>
          )}
          
          <span class="text-sm text-gray-500 dark:text-gray-400 truncate max-w-[250px] md:max-w-full">
            {entry.data.title}
          </span>
          
          {nextPage && (
            <a
              href={`/english-translation-drafts/${nextPage.slug}`}
              class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shrink-0"
            >
              Next →
            </a>
          )}
        </div>
      </div>
    </div>

    {/* Main Content */}
    <div class="bg-white dark:bg-gray-800 shadow sm:rounded-lg mb-24">
      <div class="px-4 py-5 sm:p-6">
        <article class="prose lg:prose-xl dark:prose-invert max-w-none">
          <Content />
        </article>
        
        {/* Bottom Navigation (visible at the end and on mobile) */}
        <div class="mt-8 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4 navigation-end">
          {prevPage && (
            <a
              href={`/english-translation-drafts/${prevPage.slug}`}
              class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shrink-0"
            >
              ← Previous
            </a>
          )}
          
          <span class="text-sm text-gray-500 dark:text-gray-400 truncate max-w-[250px] md:max-w-full">
            {entry.data.title}
          </span>
          
          {nextPage && (
            <a
              href={`/english-translation-drafts/${nextPage.slug}`}
              class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shrink-0"
            >
              Next →
            </a>
          )}
        </div>
      </div>
    </div>
  </div>

  <style>
    .navigation-buttons {
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }

    .navigation-buttons.hide {
      opacity: 0;
      pointer-events: none;
    }

    .navigation-end {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }

    .navigation-end.show {
      opacity: 1;
    }
  </style>

  <script>
    // Handle scroll behavior for navigation buttons
    const nav = document.querySelector('.navigation-buttons');
    const endNav = document.querySelector('.navigation-end');
    
    if (nav && endNav) {
      const observer = new IntersectionObserver(
        ([entry]) => {
          if (entry.isIntersecting) {
            nav.classList.add('hide');
            endNav.classList.add('show');
          } else {
            nav.classList.remove('hide');
            endNav.classList.remove('show');
          }
        },
        {
          rootMargin: '100px',
        }
      );

      observer.observe(endNav);
    }
  </script>
</Layout> 